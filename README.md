# ğŸŒŒ Codebase

> ä¸»è¦åŸºæ–¼ ES6 (ES2015) å’Œ ES2017 èªæ³•è¦ç¯„ï¼Œä½†æ¡ç”¨ Node.js çš„ CommonJS æ¨¡çµ„è¼‰å…¥æ–¹å¼ï¼Œå±¬æ–¼å…¸å‹çš„å¾Œç«¯ JavaScript é–‹ç™¼å¯«æ³•ã€‚è‹¥è¦æ˜ç¢ºæŒ‡å®šç‰ˆæœ¬ï¼Œå¯è¦–ç‚º ES2017+ çš„å¯¦è¸ã€‚
> ç®­é ­å‡½æ•¸èˆ‡ async/await èªæ³•ã€const èˆ‡è§£æ§‹è³¦å€¼ã€æ¨¡æ¿å­—ç¬¦ä¸²(process.env.ETH_RPC_URL || "")ï¼Œæœªä½¿ç”¨ ES2020+ æ–°ç‰¹æ€§å¦‚ optional chaining (?.) æˆ– nullish coalescing (??)ï¼Œ
> ä¸” node 18.20.4 ç‰ˆæœ¬ä¸‹è¼‰ç›¸é—œå¥—ä»¶ï¼Œé›–ç„¶ node 14 ä»¥ä¸Šå°±èƒ½ç”¨ ES2020+ çš„å¯«æ³•ï¼Œä½†æ­¤å°ˆæ¡ˆé‚„æ˜¯ä»¥ ES2017+æ–¹å¼æ’°å¯«ã€‚ç•¶ç„¶æ—¥å¾Œç”¨ ES2020+ æ–°ç‰¹æ€§å»å¯¦ä½œä¹Ÿä¸å½±éŸ¿å°±æ˜¯äº†ã€‚

- src/script => populate our database with all the basic config
- src/db/models/trackedWallet.js => è¿½è¹¤ç‰¹å®šéŒ¢åŒ…åœ°å€çš„äº¤æ˜“æ´»å‹• / æä¾›æ˜“æ–¼ç®¡ç†èˆ‡åˆ†é¡çš„éŒ¢åŒ…æ¸…å–® / æ ¹æ“šéŒ¢åŒ…ç‹€æ…‹è‡ªå‹•åŸ·è¡Œæª¢æŸ¥æˆ–é€šçŸ¥
- src/db/models/chains.js => Chain Schemaï¼šç”¨ä¾†å„²å­˜å€å¡Šéˆè¨­å®šã€å€å¡Šéˆç€è¦½å™¨ç¶²å€ï¼Œä»¥åŠåŸç”Ÿä»£å¹£è³‡è¨Š
- src/db/index.js => é€™å€‹æª”æ¡ˆæœƒä½œç‚ºè³‡æ–™åº«ç›¸é—œåŠŸèƒ½çš„é€²å…¥é»
- src/polling => æŒ‡æ‡‰ç”¨ç¨‹å¼å®šæœŸå‘å€å¡Šéˆç¯€é»æˆ– API ç™¼é€è«‹æ±‚ï¼Œä»¥ç²å–æœ€æ–°çš„éˆä¸Šè³‡æ–™æˆ–ç‹€æ…‹æ›´æ–°ã€‚ä¾‹å¦‚ï¼Œé–‹ç™¼è€…æœƒé€é polling æ–¹å¼ï¼Œå®šæ™‚æŸ¥è©¢æŸå€‹éŒ¢åŒ…åœ°å€çš„é¤˜é¡ã€äº¤æ˜“ç‹€æ…‹ã€NFT æŒæœ‰æƒ…æ³ç­‰è³‡è¨Š
- src/wallet => åˆå§‹åŒ– EVM æˆ– Solana éŒ¢åŒ…ï¼Œä¾‹å¦‚ä½¿ç”¨ ethers.js æˆ– solana web3.js

## Swap æ¥­å‹™éœ€æ±‚

### ä¸»è¦ç›®æ¨™

- å”¯ä¸€ä¸”å®Œæ•´åœ°è¨˜éŒ„æ¯ä¸€ç­† Swap äº¤æ˜“
- æ”¯æ´å¤šéˆã€å¤šå¹£ç¨®çš„å…Œæ›è³‡è¨Š
- æ–¹ä¾¿å¾ŒçºŒæŸ¥è©¢ã€å ±è¡¨èˆ‡æ•¸æ“šåˆ†æ
- æ”¯æ´äº¤æ˜“è™•ç†ç‹€æ…‹è¿½è¹¤èˆ‡ç•°å¸¸ç›£æ§

- [src/db/models/swap.js => æ•´åˆ Swap åŠŸèƒ½ï¼Œä¸¦é€é Swaps Moralis API å¯¦ç¾](https://docs.moralis.com/web3-data-api/evm/reference/get-swaps-by-wallet-address?address=0xcB1C1FdE09f811B294172696404e88E658659905&chain=eth&order=DESC)

```mermaid
flowchart TD
    A["ç›£è½å€å¡Šéˆäº‹ä»¶"] --> B["è§£æ Swap äº¤æ˜“"]
    B --> C["å‰µå»º Swap è¨˜éŒ„"]
    C --> D["è¨­ç½®åˆå§‹ç‹€æ…‹: pending"]
    D --> E["è¨ˆç®— USD åƒ¹å€¼"]
    E --> F["ä¿å­˜åˆ°æ•¸æ“šåº«"]
    F --> G["è™•ç†éšŠåˆ—"]
    G --> H{"è™•ç†æˆåŠŸ?"}
    H -->|æ˜¯| I["æ›´æ–°ç‹€æ…‹: completed"]
    H -->|å¦| J["æ›´æ–°ç‹€æ…‹: failed"]
    I --> K["è¨˜éŒ„è™•ç†æ™‚é–“æˆ³"]
    J --> L["è¨˜éŒ„éŒ¯èª¤è¨Šæ¯"]
    K --> M["å®Œæˆ"]
    L --> N{"éœ€è¦é‡è©¦?"}
    N -->|æ˜¯| G
    N -->|å¦| M
```

## è³‡æºåƒè€ƒ

#### å®˜æ–¹æŠ€è¡“æ–‡ä»¶èˆ‡ API åƒè€ƒæ‰‹å†Š

- [Moralis æ˜¯ä¸€å€‹æä¾›è·¨éˆ APIã€ç”¨æˆ¶èªè­‰ã€æ•¸æ“šèšåˆã€é›²ç«¯å‡½æ•¸å’Œå³æ™‚å€å¡Šéˆäº‹ä»¶ç›£æ§ç­‰åŠŸèƒ½ï¼Œå¹«åŠ©é–‹ç™¼è€…å¿«é€Ÿå»ºæ§‹å’Œéƒ¨ç½²å€å¡Šéˆæ‡‰ç”¨çš„ Web3 å¾Œç«¯æœå‹™å¹³å°ã€‚](https://docs.moralis.com/)

#### é‡å°é–‹ç™¼è€…çš„ç”¢å“ä»‹ç´¹ã€æ‡‰ç”¨å ´æ™¯èˆ‡æ•´åˆè³‡æºå…¥å£

- [æä¾›è±å¯Œçš„å€å¡Šéˆæ•¸æ“šï¼ŒåŒ…æ‹¬ NFTã€ERC20 ä»£å¹£ã€DeFi å”è­°ã€äº¤æ˜“æ­·å²ç­‰ã€‚ä¸¦å¯ä¸€éµæ¥å…¥å¤šæ¢ä¸»æµå…¬éˆï¼ˆå¦‚ Ethereumã€BNBã€Polygonã€Avalancheã€Fantom ç­‰ï¼‰ã€‚æ”¯æ´å³æ™‚èˆ‡æ­·å²åƒ¹æ ¼ã€å®Œæ•´éŒ¢åŒ…çµ„åˆæ•¸æ“šã€è§£ç¢¼å¾Œçš„ DeFi è³‡ç”¢ç­‰](https://developers.moralis.com/)

#### è·¨å¤šæ¢å…¬éˆè‡ªå‹•æ¯”åƒ¹ã€æœ€ä½³è·¯å¾‘çš„ä»£å¹£å…Œæ›èšåˆ AP

- [1inch Swap API çš„ç”¨é€”æ˜¯è®“é–‹ç™¼è€…åœ¨å„å¤§å€å¡Šéˆï¼ˆå¦‚ä»¥å¤ªåŠã€BNB éˆã€Polygon ç­‰ï¼‰ä¸Šï¼Œé€éè·¯ç”±å’Œèšåˆç®—æ³•ï¼Œå¯¦ç¾ç”¨æˆ¶è‡ªæ‰˜ç®¡éŒ¢åŒ…ä¹‹é–“çš„ä»£å¹£é–ƒå…Œï¼Œä¸¦è‡ªå‹•å°‹æ‰¾æœ€ä½³åƒ¹æ ¼å’Œè·¯å¾‘ï¼Œæ–¹ä¾¿æ•´åˆåˆ°éŒ¢åŒ…ã€dApp æˆ–äº¤æ˜“å¹³å°ä¸­](https://portal.1inch.dev/documentation/apis/swap/classic-swap/quick-start)

#### Solana ä¸Šä¸€ç«™å¼èšåˆæµå‹•æ€§ã€é–ƒå…Œèˆ‡äº¤æ˜“ä¿è­·çš„é«˜æ•ˆ API

- [Jupiter Ultra API çš„ç”¨é€”æ˜¯è®“é–‹ç™¼è€…åœ¨ Solana ä¸Šèšåˆå¤šå€‹æµå‹•æ€§ä¾†æºï¼Œå¯¦ç¾ç”¨æˆ¶ä»£å¹£é–ƒå…Œã€æŸ¥è©¢æœ€ä½³åƒ¹æ ¼ã€ç²å–è³¬æˆ¶é¤˜é¡ã€ä¼°ç®—æ»‘é»ã€ä¿è­·ç”¨æˆ¶å…æ–¼ MEV æ”»æ“Šï¼Œä¸¦ç°¡åŒ–äº¤æ˜“ç°½åèˆ‡åŸ·è¡Œæµç¨‹ï¼Œç„¡éœ€è‡ªå·±è™•ç† RPCã€æ‰‹çºŒè²»æˆ–äº¤æ˜“å»£æ’­ç­‰åº•å±¤ç´°ç¯€ã€‚](https://dev.jup.ag/docs/ultra-api/)

#### å°ˆæ¡ˆç”¨åˆ°çš„å¥—ä»¶èˆ‡ç‰ˆæœ¬

| å¥—ä»¶åç¨±              | ç‰ˆæœ¬    | èªªæ˜                                                                                                                 |
| --------------------- | ------- | -------------------------------------------------------------------------------------------------------------------- |
| @solana/web3.js       | ^1.98.2 | 2025/05/28 ç‰ˆæœ¬ä¸€è‡´                                                                                                  |
| axios                 | ^1.9.0  | 2025/05/28 ç‰ˆæœ¬ä¸€è‡´                                                                                                  |
| base-58               | ^0.0.1  | 11 å¹´æœªæ›´æ–°ï¼ŒåŠŸèƒ½å–®ç´”ï¼Œåƒ…é©ç”¨æ–¼éå¸¸åŸºæœ¬éœ€æ±‚ï¼Œä¹‹å¾Œæ‡‰è©²æœƒæ”¹æˆ bs58 > 6.0.0 ç©©å®šã€ä¸»æµï¼Œå»£æ³›ç”¨æ–¼åŠ å¯†è²¨å¹£èˆ‡å€å¡Šéˆå°ˆæ¡ˆ    |
| dotenv                | ^16.5.0 | 2025/05/28 ç‰ˆæœ¬ä¸€è‡´                                                                                                  |
| ethers                | 5.0.0   | å…ˆä¸å‡ç´šï¼Œv5 é©åˆéœ€è¦ç¶­è­·èˆŠå°ˆæ¡ˆæˆ–ä¾è³´å¤§é‡ç¤¾ç¾¤ç¾æœ‰æ•™å­¸çš„æƒ…å¢ƒã€‚ v6 é©åˆæ–°å°ˆæ¡ˆï¼Œäº«å—æ›´ç¾ä»£åŒ–èªæ³•ã€æ›´ç°¡æ½” API å’Œæ›´å¥½æ•ˆèƒ½ |
| mongodb               | ^6.16.0 | 25/05/28 æœ€æ–°ç‰ˆæ˜¯ 6.16.0                                                                                             |
| mongoose              | ^8.15.1 | 25/05/28 æœ€æ–°ç‰ˆæœ¬ç‚º 8.15.1                                                                                           |
| node-telegram-bot-api | ^0.65.1 | 25/05/28 æœ€æ–°ç‰ˆæœ¬ç‚º 0.66.1                                                                                           |
| nodemon               | ^3.1.10 | 25/05/28 æœ€æ–°ç‰ˆæœ¬ç‚º 3.1.10                                                                                           |

                                                                                                           |

#### ethers.js v5 èˆ‡ v6 ä¸»è¦å·®ç•°æ¯”è¼ƒ

| ç‰¹æ€§/å¯«æ³•           | ethers v5                          | ethers v6                                 |
| ------------------- | ---------------------------------- | ----------------------------------------- |
| æ•¸å­—è™•ç†            | ä½¿ç”¨è‡ªæœ‰ BigNumber é¡              | æ”¹ç”¨åŸç”Ÿ ES2020 BigInt                    |
| Provider å¯¦ä¾‹       | `ethers.providers.JsonRpcProvider` | `ethers.JsonRpcProvider`                  |
| Web3Provider å‘½å   | `Web3Provider`                     | æ”¹åç‚º `BrowserProvider`                  |
| åˆç´„æ–¹æ³•èª¿ç”¨        | éœ€è™•ç†æ–¹æ³•ç°½åè¡çª                 | ç”¨ Proxy å‹•æ…‹è§£æï¼ŒTyped API æ›´ç°¡æ½”       |
| æ–¹æ³•å®šç¾©            | æ–¹æ³•åˆ†åœ¨ buckets                   | æ¯å€‹æ–¹æ³•ç›´æ¥æ›è¼‰ less-common æ“ä½œ         |
| å°å…¥æ–¹å¼            | å¤šå­åŒ…ã€monorepo                   | æ‰€æœ‰ API é›†ä¸­åœ¨ä¸»åŒ…ï¼Œpkg.exports æ”¯æ´ç´°åˆ† |
| äº¤æ˜“æ‰‹çºŒè²»          | å¤šå€‹ fee åƒæ•¸                      | çµ±ä¸€ç‚º `.getFeeData()`                    |
| Transaction helpers | åˆ†æ•£å¤šè™•                           | é›†ä¸­æ–¼ `Transaction` é¡                   |

##### ethers.js v5 èˆ‡ v6 ä¸»è¦å·®ç•°æ¯”è¼ƒå¯¦éš›ä»£ç¢¼ç¯„ä¾‹

```

// v5 å¯«æ³•ï¼š
import { ethers } from 'ethers';
const provider = new ethers.providers.JsonRpcProvider(url);
const contract = new ethers.Contract(address, abi, provider);

```

```

// v6 å¯«æ³•ï¼š
import { ethers } from 'ethers';
const provider = new ethers.JsonRpcProvider(url);
const contract = new ethers.Contract(address, abi, provider);

```

```

BigNumber èˆ‡ BigInt å·®ç•°ï¼š
v5: ethers.BigNumber.from('1000000000000000000')
v6: 12345678901234567890nï¼ˆç›´æ¥ç”¨ JS çš„ BigIntï¼‰

```
