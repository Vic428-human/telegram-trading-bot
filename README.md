# ğŸŒŒ Codebase

> ä¸»è¦åŸºæ–¼ ES6 (ES2015) å’Œ ES2017 èªæ³•è¦ç¯„ï¼Œä½†æ¡ç”¨ Node.js çš„ CommonJS æ¨¡çµ„è¼‰å…¥æ–¹å¼ï¼Œå±¬æ–¼å…¸å‹çš„å¾Œç«¯ JavaScript é–‹ç™¼å¯«æ³•ã€‚è‹¥è¦æ˜ç¢ºæŒ‡å®šç‰ˆæœ¬ï¼Œå¯è¦–ç‚º ES2017+ çš„å¯¦è¸ã€‚
> ç®­é ­å‡½æ•¸èˆ‡ async/await èªæ³•ã€const èˆ‡è§£æ§‹è³¦å€¼ã€æ¨¡æ¿å­—ç¬¦ä¸²(process.env.ETH_RPC_URL || "")ï¼Œæœªä½¿ç”¨ ES2020+ æ–°ç‰¹æ€§å¦‚ optional chaining (?.) æˆ– nullish coalescing (??)ï¼Œ
> ä¸” node 18.20.4 ç‰ˆæœ¬ä¸‹è¼‰ç›¸é—œå¥—ä»¶ï¼Œé›–ç„¶ node 14 ä»¥ä¸Šå°±èƒ½ç”¨ ES2020+ çš„å¯«æ³•ï¼Œä½†æ­¤å°ˆæ¡ˆé‚„æ˜¯ä»¥ ES2017+æ–¹å¼æ’°å¯«ã€‚ç•¶ç„¶æ—¥å¾Œç”¨ ES2020+ æ–°ç‰¹æ€§å»å¯¦ä½œä¹Ÿä¸å½±éŸ¿å°±æ˜¯äº†ã€‚

- src/polling => æŒ‡æ‡‰ç”¨ç¨‹å¼å®šæœŸå‘å€å¡Šéˆç¯€é»æˆ– API ç™¼é€è«‹æ±‚ï¼Œä»¥ç²å–æœ€æ–°çš„éˆä¸Šè³‡æ–™æˆ–ç‹€æ…‹æ›´æ–°ã€‚ä¾‹å¦‚ï¼Œé–‹ç™¼è€…æœƒé€é polling æ–¹å¼ï¼Œå®šæ™‚æŸ¥è©¢æŸå€‹éŒ¢åŒ…åœ°å€çš„é¤˜é¡ã€äº¤æ˜“ç‹€æ…‹ã€NFT æŒæœ‰æƒ…æ³ç­‰è³‡è¨Š
- src/wallet => åˆå§‹åŒ– EVM æˆ– Solana éŒ¢åŒ…ï¼Œä¾‹å¦‚ä½¿ç”¨ ethers.js æˆ– solana web3.js

## ä¸»è¦ç›®æ¨™

ğŸ¤– Telegram Swap Copy Trading Bot
ä¸€å€‹è‡ªå‹•è¤‡è£½éˆä¸ŠéŒ¢åŒ…äº¤æ˜“è¡Œç‚ºçš„ Telegram æ©Ÿå™¨äººï¼Œæ”¯æ´å¤šéˆï¼ˆEVM / Solanaï¼‰èˆ‡ DEXï¼ˆ1inch / Jupiterï¼‰

âœ… åŠŸèƒ½æ¸…å–®
ä»¥ä¸‹ç‚ºç›®å‰å°ˆæ¡ˆçš„ä¸»è¦åŠŸèƒ½æ¨¡çµ„èˆ‡å¾…å®Œæˆ/å·²å®Œæˆä»»å‹™ï¼Œå¯å‹¾é¸é€²è¡Œé€²åº¦è¿½è¹¤ã€‚

### 1. ğŸ§‘â€ğŸ’» ä½¿ç”¨è€…äº’å‹•å±¤ï¼ˆUser Interfaceï¼‰

- [ ] æ”¯æ´ `/start` å•Ÿå‹•æ©Ÿå™¨äºº
- [ ] æ”¯æ´ `/add_wallet` æ–°å¢ç›£æ§éŒ¢åŒ…
- [ ] æ”¯æ´ `/remove_wallet` åˆªé™¤éŒ¢åŒ…
- [ ] æ”¯æ´ `/list_wallets` æŸ¥çœ‹æ‰€æœ‰å·²è¿½è¹¤éŒ¢åŒ…
- [ ] æ”¯æ´ `/config` è¨­å®šè¤‡è£½ç­–ç•¥ï¼ˆGasã€æ¯”ä¾‹ç­‰ï¼‰
- [ ] æ”¯æ´ `/help` é¡¯ç¤ºä½¿ç”¨èªªæ˜

---

### 2. ğŸ¤– Telegram æ©Ÿå™¨äººä»‹é¢ï¼ˆTelegram Bot Interfaceï¼‰

- [ ] æ¥æ”¶ä¸¦è§£æç”¨æˆ¶æŒ‡ä»¤
- [ ] ç™¼é€è¨Šæ¯å›æ‡‰ç”¨æˆ¶æ“ä½œçµæœ
- [ ] æ•´åˆå‘½ä»¤è™•ç†èˆ‡é€šçŸ¥æ¨¡çµ„

---

### 3. ğŸ“œ å‘½ä»¤è™•ç†æ¨¡çµ„ï¼ˆCommand Handlersï¼‰

- [x] åˆå§‹åŒ–ä¸åŒéˆçš„è³‡æ–™çµ¦ DB scripts/initDB.js
- [x] åˆå§‹åŒ–æ©Ÿå™¨äººé…ç½®çµ¦ DB scripts/initDB.js
- [x] ç”¨ requiredSettings å¢é‡è£œé½Šå¿…è¦è¨­å®šï¼Œé¿å…è¦†è“‹æ‰æ©Ÿå™¨äººåŸå…ˆçš„åˆå§‹é…ç½®ï¼Œæå‡å®‰å…¨æ€§èˆ‡æ“´å±•æ€§ scripts/initDB.js
- [ ] è§£æ `/add_wallet` ç­‰æŒ‡ä»¤
- [ ] æ›´æ–°è³‡æ–™åº«ä¸­ç”¨æˆ¶é…ç½®èˆ‡éŒ¢åŒ…åˆ—è¡¨
- [ ] è§¸ç™¼å°æ‡‰æµç¨‹ï¼ˆå¦‚æ–°å¢éŒ¢åŒ…å¾Œå•Ÿå‹•ç›£æ§ï¼‰

---

### 4. ğŸ—ƒï¸ è³‡æ–™åº«æ¨¡çµ„ï¼ˆDatabase Modelsï¼‰

- [x] Chain Modelï¼šå„²å­˜æ”¯æ´çš„å€å¡Šéˆè³‡è¨Š src/db/models/chains.js
- [x] Tracked Wallet Modelï¼šè¨˜éŒ„ç”¨æˆ¶è¿½è¹¤çš„éŒ¢åŒ…åœ°å€èˆ‡æ‰€å±¬éˆ src/db/models/trackedWallet.js
- [x] [Swap Modelï¼šå„²å­˜åµæ¸¬åˆ°çš„äº¤æ˜“èˆ‡åŸ·è¡Œç‹€æ…‹ src/db/models/swap.js](https://docs.moralis.com/web3-data-api/evm/reference/get-swaps-by-wallet-address?address=0xcB1C1FdE09f811B294172696404e88E658659905&chain=eth&order=DESC)
- [x] Bot Config Modelï¼šè·Ÿæ©Ÿå™¨äººæœ‰é—œçš„åŸºæœ¬é…ç½®è¨Šæ¯ï¼Œä¾‹å¦‚æ˜¯å¦ bot æœ‰æ­£å¸¸é‹è¡Œï¼šsrc/db/models/botConfig.js
- [x] DB é€£ç·šæˆåŠŸæˆ–å¤±æ•—é‚è¼¯ src/db/index.js

---

### 5. ğŸ” å®šæ™‚è¼ªè©¢æœå‹™ï¼ˆPolling Servicesï¼‰

#### a. Swap Fetcher

- [ ] å®šæœŸå‘¼å« Moralis API æˆ– RPC å–å¾—éŒ¢åŒ…æ­·å² Swap
- [ ] éæ¿¾æ–°äº¤æ˜“ï¼ˆé¿å…é‡è¤‡åŸ·è¡Œï¼‰
- [ ] å„²å­˜æ–°äº¤æ˜“è‡³è³‡æ–™åº«ç‚ºã€Œå¾…è™•ç†ã€

#### b. Swap Processor

- [ ] å¾è³‡æ–™åº«å–å‡ºã€Œå¾…è™•ç†ã€Swap
- [ ] å‘¼å« Execution Service è¤‡è£½äº¤æ˜“
- [ ] æ›´æ–°äº¤æ˜“ç‹€æ…‹ï¼ˆåŸ·è¡Œä¸­ / æˆåŠŸ / å¤±æ•—ï¼‰
- [ ] ç™¼é€äº¤æ˜“çµæœé€šçŸ¥çµ¦ç”¨æˆ¶

#### c. Cleanup Service

- [ ] å®šæœŸæ¸…ç†éæœŸ Swap è¨˜éŒ„ï¼ˆå¦‚è¶…é 24 å°æ™‚æœªåŸ·è¡Œï¼‰
- [ ] ç¢ºä¿è³‡æ–™åº«æ•ˆèƒ½ç©©å®š

---

### 6. ğŸŒ å¤–éƒ¨ API æ•´åˆï¼ˆExternal APIsï¼‰

- [ ] æ•´åˆ Moralis API å–å¾—éŒ¢åŒ…äº¤æ˜“
- [ ] æ•´åˆ Blockchain RPCs æäº¤äº¤æ˜“è‡³ç›®æ¨™éˆ
- [ ] æ•´åˆ 1inch API ç”¨æ–¼ EVM Swap
- [ ] æ•´åˆ Jupiter API ç”¨æ–¼ Solana Swap

---

### 7. ğŸ”— å€å¡Šéˆæœå‹™æ¨¡çµ„ï¼ˆChain Servicesï¼‰

#### a. EVM Chain Service

- [ ] æ”¯æ´ Ethereumã€BSCã€Polygon ç­‰ EVM éˆ
- [ ] è™•ç† ERC-20ã€ERC-721 äº¤æ˜“ç°½ç½²èˆ‡å»£æ’­

#### b. Solana Chain Service

- [ ] æ”¯æ´ SPL Token èˆ‡ Jupiter äº¤æ˜“æ ¼å¼
- [ ] è™•ç†äº¤æ˜“ç°½ç½²èˆ‡æäº¤è‡³ Solana éˆ

---

### 8. âš¡ åŸ·è¡Œæœå‹™æ¨¡çµ„ï¼ˆExecution Servicesï¼‰

#### a. 1inch Swap

- [ ] æ ¹æ“š 1inch API å›å‚³è³‡æ–™è¤‡è£½ Swap
- [ ] æ”¯æ´ Gas åƒ¹æ ¼å„ªåŒ–èˆ‡æ»‘é»å®¹å¿åº¦èª¿æ•´

#### b. Jupiter Swap

- [ ] ä½¿ç”¨ Jupiter SDK å»ºç«‹ Solana Swap äº¤æ˜“
- [ ] è‡ªå‹•è™•ç†è·¯ç”±èˆ‡äº¤æ˜“æ‰“åŒ…

#### c. éŒ¢åŒ…æœå‹™æ•´åˆ

- [ ] ç§é‘°åŠ å¯†ç®¡ç†
- [ ] ç”¢ç”Ÿäº¤æ˜“ç°½ç« 
- [ ] ç™¼é€åˆ°å°æ‡‰éˆçš„ RPC ç¯€é»

---

### 9. ğŸ”” é€šçŸ¥æ¨¡çµ„ï¼ˆNotification Serviceï¼‰

- [ ] æ”¯æ´æˆåŠŸ/å¤±æ•—é€šçŸ¥
- [ ] æ”¯æ´éŒ¯èª¤åŸå› æç¤º
- [ ] æ”¯æ´ç”¨æˆ¶è‡ªè¨‚é€šçŸ¥åå¥½ï¼ˆä¾‹å¦‚åƒ…æ¥æ”¶å¤±æ•—é€šçŸ¥ï¼‰

---

### ğŸ”„ ä¸»è¦æµç¨‹é‚è¼¯ï¼ˆæ¥­å‹™æµï¼‰

- [ ] ç”¨æˆ¶æ–°å¢éŒ¢åŒ…
- [ ] ä½¿ç”¨ Telegram ç™¼é€ `/add_wallet` æŒ‡ä»¤
- [ ] Bot å°‡éŒ¢åŒ…åœ°å€èˆ‡éˆè³‡è¨Šå­˜å…¥è³‡æ–™åº«
- [ ] å®šæœŸæª¢æ¸¬äº¤æ˜“
- [ ] Swap Fetcher å®šæœŸå‘¼å« Moralis API æª¢æŸ¥éŒ¢åŒ… Swap
- [ ] ç™¼ç¾æ–°äº¤æ˜“å¾Œå­˜å…¥è³‡æ–™åº«ç‚ºã€Œå¾…è™•ç†ã€
- [ ] Swap Processor å–å‡ºå¾…è™•ç†äº¤æ˜“
- [ ] å‘¼å« Execution Services ç°½ç½²ä¸¦æäº¤äº¤æ˜“è‡³éˆä¸Š
- [ ] é€šçŸ¥æœå‹™å°‡åŸ·è¡Œçµæœå›å ±çµ¦ç”¨æˆ¶
- [ ] Cleanup Service å®šæœŸæ¸…é™¤èˆŠäº¤æ˜“è¨˜éŒ„

## è³‡æºåƒè€ƒ

#### å®˜æ–¹æŠ€è¡“æ–‡ä»¶èˆ‡ API åƒè€ƒæ‰‹å†Š

- [Moralis æ˜¯ä¸€å€‹æä¾›è·¨éˆ APIã€ç”¨æˆ¶èªè­‰ã€æ•¸æ“šèšåˆã€é›²ç«¯å‡½æ•¸å’Œå³æ™‚å€å¡Šéˆäº‹ä»¶ç›£æ§ç­‰åŠŸèƒ½ï¼Œå¹«åŠ©é–‹ç™¼è€…å¿«é€Ÿå»ºæ§‹å’Œéƒ¨ç½²å€å¡Šéˆæ‡‰ç”¨çš„ Web3 å¾Œç«¯æœå‹™å¹³å°ã€‚](https://docs.moralis.com/)

#### é‡å°é–‹ç™¼è€…çš„ç”¢å“ä»‹ç´¹ã€æ‡‰ç”¨å ´æ™¯èˆ‡æ•´åˆè³‡æºå…¥å£

- [æä¾›è±å¯Œçš„å€å¡Šéˆæ•¸æ“šï¼ŒåŒ…æ‹¬ NFTã€ERC20 ä»£å¹£ã€DeFi å”è­°ã€äº¤æ˜“æ­·å²ç­‰ã€‚ä¸¦å¯ä¸€éµæ¥å…¥å¤šæ¢ä¸»æµå…¬éˆï¼ˆå¦‚ Ethereumã€BNBã€Polygonã€Avalancheã€Fantom ç­‰ï¼‰ã€‚æ”¯æ´å³æ™‚èˆ‡æ­·å²åƒ¹æ ¼ã€å®Œæ•´éŒ¢åŒ…çµ„åˆæ•¸æ“šã€è§£ç¢¼å¾Œçš„ DeFi è³‡ç”¢ç­‰](https://developers.moralis.com/)

#### è·¨å¤šæ¢å…¬éˆè‡ªå‹•æ¯”åƒ¹ã€æœ€ä½³è·¯å¾‘çš„ä»£å¹£å…Œæ›èšåˆ AP

- [1inch Swap API çš„ç”¨é€”æ˜¯è®“é–‹ç™¼è€…åœ¨å„å¤§å€å¡Šéˆï¼ˆå¦‚ä»¥å¤ªåŠã€BNB éˆã€Polygon ç­‰ï¼‰ä¸Šï¼Œé€éè·¯ç”±å’Œèšåˆç®—æ³•ï¼Œå¯¦ç¾ç”¨æˆ¶è‡ªæ‰˜ç®¡éŒ¢åŒ…ä¹‹é–“çš„ä»£å¹£é–ƒå…Œï¼Œä¸¦è‡ªå‹•å°‹æ‰¾æœ€ä½³åƒ¹æ ¼å’Œè·¯å¾‘ï¼Œæ–¹ä¾¿æ•´åˆåˆ°éŒ¢åŒ…ã€dApp æˆ–äº¤æ˜“å¹³å°ä¸­](https://portal.1inch.dev/documentation/apis/swap/classic-swap/quick-start)

#### Solana ä¸Šä¸€ç«™å¼èšåˆæµå‹•æ€§ã€é–ƒå…Œèˆ‡äº¤æ˜“ä¿è­·çš„é«˜æ•ˆ API

- [Jupiter Ultra API çš„ç”¨é€”æ˜¯è®“é–‹ç™¼è€…åœ¨ Solana ä¸Šèšåˆå¤šå€‹æµå‹•æ€§ä¾†æºï¼Œå¯¦ç¾ç”¨æˆ¶ä»£å¹£é–ƒå…Œã€æŸ¥è©¢æœ€ä½³åƒ¹æ ¼ã€ç²å–è³¬æˆ¶é¤˜é¡ã€ä¼°ç®—æ»‘é»ã€ä¿è­·ç”¨æˆ¶å…æ–¼ MEV æ”»æ“Šï¼Œä¸¦ç°¡åŒ–äº¤æ˜“ç°½åèˆ‡åŸ·è¡Œæµç¨‹ï¼Œç„¡éœ€è‡ªå·±è™•ç† RPCã€æ‰‹çºŒè²»æˆ–äº¤æ˜“å»£æ’­ç­‰åº•å±¤ç´°ç¯€ã€‚](https://dev.jup.ag/docs/ultra-api/)

#### å°ˆæ¡ˆç”¨åˆ°çš„å¥—ä»¶èˆ‡ç‰ˆæœ¬

| å¥—ä»¶åç¨±              | ç‰ˆæœ¬    | èªªæ˜                                                                                                                 |
| --------------------- | ------- | -------------------------------------------------------------------------------------------------------------------- |
| @solana/web3.js       | ^1.98.2 | 2025/05/28 ç‰ˆæœ¬ä¸€è‡´                                                                                                  |
| axios                 | ^1.9.0  | 2025/05/28 ç‰ˆæœ¬ä¸€è‡´                                                                                                  |
| base-58               | ^0.0.1  | 11 å¹´æœªæ›´æ–°ï¼ŒåŠŸèƒ½å–®ç´”ï¼Œåƒ…é©ç”¨æ–¼éå¸¸åŸºæœ¬éœ€æ±‚ï¼Œä¹‹å¾Œæ‡‰è©²æœƒæ”¹æˆ bs58 > 6.0.0 ç©©å®šã€ä¸»æµï¼Œå»£æ³›ç”¨æ–¼åŠ å¯†è²¨å¹£èˆ‡å€å¡Šéˆå°ˆæ¡ˆ    |
| dotenv                | ^16.5.0 | 2025/05/28 ç‰ˆæœ¬ä¸€è‡´                                                                                                  |
| ethers                | 5.0.0   | å…ˆä¸å‡ç´šï¼Œv5 é©åˆéœ€è¦ç¶­è­·èˆŠå°ˆæ¡ˆæˆ–ä¾è³´å¤§é‡ç¤¾ç¾¤ç¾æœ‰æ•™å­¸çš„æƒ…å¢ƒã€‚ v6 é©åˆæ–°å°ˆæ¡ˆï¼Œäº«å—æ›´ç¾ä»£åŒ–èªæ³•ã€æ›´ç°¡æ½” API å’Œæ›´å¥½æ•ˆèƒ½ |
| mongodb               | ^6.16.0 | 25/05/28 æœ€æ–°ç‰ˆæ˜¯ 6.16.0                                                                                             |
| mongoose              | ^8.15.1 | 25/05/28 æœ€æ–°ç‰ˆæœ¬ç‚º 8.15.1                                                                                           |
| node-telegram-bot-api | ^0.65.1 | 25/05/28 æœ€æ–°ç‰ˆæœ¬ç‚º 0.66.1                                                                                           |
| nodemon               | ^3.1.10 | 25/05/28 æœ€æ–°ç‰ˆæœ¬ç‚º 3.1.10                                                                                           |

                                                                                                           |

#### ethers.js v5 èˆ‡ v6 ä¸»è¦å·®ç•°æ¯”è¼ƒ

| ç‰¹æ€§/å¯«æ³•           | ethers v5                          | ethers v6                                 |
| ------------------- | ---------------------------------- | ----------------------------------------- |
| æ•¸å­—è™•ç†            | ä½¿ç”¨è‡ªæœ‰ BigNumber é¡              | æ”¹ç”¨åŸç”Ÿ ES2020 BigInt                    |
| Provider å¯¦ä¾‹       | `ethers.providers.JsonRpcProvider` | `ethers.JsonRpcProvider`                  |
| Web3Provider å‘½å   | `Web3Provider`                     | æ”¹åç‚º `BrowserProvider`                  |
| åˆç´„æ–¹æ³•èª¿ç”¨        | éœ€è™•ç†æ–¹æ³•ç°½åè¡çª                 | ç”¨ Proxy å‹•æ…‹è§£æï¼ŒTyped API æ›´ç°¡æ½”       |
| æ–¹æ³•å®šç¾©            | æ–¹æ³•åˆ†åœ¨ buckets                   | æ¯å€‹æ–¹æ³•ç›´æ¥æ›è¼‰ less-common æ“ä½œ         |
| å°å…¥æ–¹å¼            | å¤šå­åŒ…ã€monorepo                   | æ‰€æœ‰ API é›†ä¸­åœ¨ä¸»åŒ…ï¼Œpkg.exports æ”¯æ´ç´°åˆ† |
| äº¤æ˜“æ‰‹çºŒè²»          | å¤šå€‹ fee åƒæ•¸                      | çµ±ä¸€ç‚º `.getFeeData()`                    |
| Transaction helpers | åˆ†æ•£å¤šè™•                           | é›†ä¸­æ–¼ `Transaction` é¡                   |

##### ethers.js v5 èˆ‡ v6 ä¸»è¦å·®ç•°æ¯”è¼ƒå¯¦éš›ä»£ç¢¼ç¯„ä¾‹

```

// v5 å¯«æ³•ï¼š
import { ethers } from 'ethers';
const provider = new ethers.providers.JsonRpcProvider(url);
const contract = new ethers.Contract(address, abi, provider);

```

```

// v6 å¯«æ³•ï¼š
import { ethers } from 'ethers';
const provider = new ethers.JsonRpcProvider(url);
const contract = new ethers.Contract(address, abi, provider);

```

```

BigNumber èˆ‡ BigInt å·®ç•°ï¼š
v5: ethers.BigNumber.from('1000000000000000000')
v6: 12345678901234567890nï¼ˆç›´æ¥ç”¨ JS çš„ BigIntï¼‰

```
